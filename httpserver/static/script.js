function ZoomCorrection(){VIEW_X>0&&VIEW_Y>0&&(VIEW_X/VIEW_Y>GameW/GameH?Zoom<GameH/VIEW_Y/2&&(Zoom=GameH/VIEW_Y/2):Zoom<GameW/VIEW_X/2&&(Zoom=GameW/VIEW_X/2))}PIXI.sound.add("MainMenuMusic",{url:"static\\mainMenuMusic.mp3",preload:!0,autoPlay:!0}),document.onkeydown=function(e){(9==e.keyCode||112==e.keyCode||114==e.keyCode)&&e.preventDefault()},document.getElementById("ServerAddress").value=document.getElementById("ServerSelect").value;let GameStatus="MainMenu",BGLayers=[[0,"../static/BG1/BG.svg"],[.0625,"../static/BG1/BG0.svg"],[.03125,"../static/BG1/BG1.svg"],[.015625,"../static/BG1/BG2.svg"],[.0078125,"../static/BG1/BG3.svg"],[-.00390625,"../static/BG1/BG4.svg"]];function UpdateBG(e){MainScreen.innerHTML="";for(let t=0;t<BGLayers.length;t++)MainScreen.innerHTML+='<div class="BGSVGLayer" id="SvgLayer'+t+'" style="background-image: url('+BGLayers[t][1]+');"></div>'}function forgetServer(){document.getElementById("online").innerHTML="?/?",document.getElementById("text").innerHTML="No information yet",document.getElementById("impprev").src=""}function onMouseUpdate(e){let t=e.pageX;for(let a=0;a<BGLayers.length;a++)document.getElementById("SvgLayer"+a).style.transform="translateX("+(t-window.innerWidth/2)*BGLayers[a][0]*1920/window.innerWidth+"px)"}function ExitGame(){Send=!0,messagebtn.innerText="Global",messageinput.value="/leave",setTimeout(function(){if("InGame"==GameStatus){GameStatus="MainMenu",PlayersData=new Map,PIXI.sound.play("MainMenuMusic");let e=document.getElementById("Inventory").children;for(let t=0;t<e.length;t++)e[t].style.display="";document.getElementById("chk-game").checked=!1,document.getElementById("chkInterfaceHide").checked=!1,chatview.innerHTML="",Players=[],socket.close()}},500)}UpdateBG(),document.addEventListener("mousemove",onMouseUpdate,!1),document.addEventListener("mouseenter",onMouseUpdate,!1),window.onresize=resize;let ParticlesProcessing=!0;function ChSttSettings(){"none"==document.getElementById("SettingsForm").style.display?document.getElementById("SettingsForm").style.display="block":document.getElementById("SettingsForm").style.display="none"}function UpdtParticles(){ParticlesProcessing=document.getElementById("ParticlesChk").checked,localStorage.setItem("SettingsParticlesChkVal",document.getElementById("ParticlesChk").checked)}function UpdtVolumes(){let e=document.getElementById("VolumeRange").value,t=document.getElementById("MusicRange").value;localStorage.setItem("SettingsVolumeRangeVal",e),localStorage.setItem("SettingsMusicRangeVal",t),PIXI.sound.volume("MainMenuMusic",t),PIXI.sound.volumeAll=e}""!=localStorage.getItem("SettingsParticlesChkVal")&&null!=localStorage.getItem("SettingsParticlesChkVal")&&(ParticlesProcessing="true"==localStorage.getItem("SettingsParticlesChkVal")),document.getElementById("ParticlesChk").checked=ParticlesProcessing,document.getElementById("NameField").value=sessionStorage.getItem("NameFieldVal");var Vehicles,VehList,PlayerName,CurVehicle,PlayerTags=new Map;function NoTeamTag(e,t=!0){return void 0==e?void 0:e.split("]").length>1?(t&&PlayerTags.set(e.split("]")[1],e.split("]")[0].slice(1)),e.split("]")[1]):(t&&PlayerTags.set(e,null),e)}let GameH=0,GameW=0;PIXI.sound.add("bang","static\\bang.mp3",preload=!0),PIXI.sound.add("wtrBang","static\\wtrBang.mp3",preload=!0),PIXI.sound.add("lnchTrpd","static\\TorpedoLaunch.mp3",preload=!0),PIXI.sound.add("lnchRckt","static\\RocketLaunch.mp3",preload=!0),PIXI.sound.add("bombFall","static\\bombFall4s.mp3",preload=!0),PIXI.sound.add("rocketHit","static\\rocketHit.mp3",preload=!0),PIXI.sound.add("dmg0","static\\dmg\\0.mp3",preload=!0),PIXI.sound.add("dmg1","static\\dmg\\1.mp3",preload=!0),PIXI.sound.add("dmg2","static\\dmg\\2.mp3",preload=!0),PIXI.sound.add("dmg3","static\\dmg\\3.mp3",preload=!0),PIXI.sound.add("Sdmg0","static\\Sdmg\\0.mp3",preload=!0),PIXI.sound.add("Sdmg1","static\\Sdmg\\1.mp3",preload=!0),PIXI.sound.add("mcanon","static\\mcanon.mp3",preload=!0),PIXI.sound.add("pcanon","static\\pcanon.mp3",preload=!0),PIXI.sound.add("tcanon","static\\mcanon.mp3",preload=!0),PIXI.sound.add("hcanon","static\\pcanon.mp3",preload=!0),PIXI.sound.add("fcanon","static\\pcanon.mp3",preload=!0);var cameraMode=!1,Players=[],TorpedosData=new Map,AARocketsData=new Map,BombsData=new Map,BulletsData=new Map,SmokesData=new Map,ColorPack="Summer",PlayersData=new Map,VIEW_X=0,VIEW_Y=0,Zones="",SelectedVehicleShopId=null;function onWheel(e){e.deltaY>0?Zoom-=10:Zoom+=10,Zoom>640&&(Zoom=640),ZoomCorrection()}function ShowPrevVeh(){for(let e of(sessionStorage.setItem("VehicleSelectVal",document.getElementById("VehicleSelect").value),VehList))if(e[1]==document.getElementById("VehicleSelect").value){document.getElementById("vehprev").src=e[2],SelectedVehicleShopId=e[3];break}}function GetServerInfo(){try{let e=new WebSocket(document.getElementById("ServerAddress").value);e.addEventListener("open",function(t){console.log("!"),e.send("info")}),e.addEventListener("message",function e(t){console.log(t.data);var a=JSON.parse(t.data);console.log(a),document.getElementById("impprev").src=a.map,document.getElementById("Map").src=a.map,document.getElementById("online").innerHTML="Players: "+a.online,document.getElementById("text").innerHTML=a.text,console.log(a.js),console.log(document.getElementById("prevmpjs").src),document.getElementById("prevmpjs").src=a.js,BGLayers=a.bg,UpdateBG(),MainScreen.style.background=a.bg_cl,VIEW_X=a.VIEW_X,VIEW_Y=a.VIEW_Y,VehList=a.vehicleAvailable,document.getElementById("VehicleSelect").innerHTML="";let s=!0;for(let l of VehList)document.getElementById("VehicleSelect").innerHTML+='<option value = "'+l[1]+'">'+l[0]+"</option>",Number(l[1])==Number(sessionStorage.getItem("VehicleSelectVal"))&&(s=!1);s||""==sessionStorage.getItem("VehicleSelectVal")||null==sessionStorage.getItem("VehicleSelectVal")?(console.log(a.vehicleAvailable[0][1]),document.getElementById("VehicleSelect").value=a.vehicleAvailable[0][1]):document.getElementById("VehicleSelect").value=sessionStorage.getItem("VehicleSelectVal"),ShowPrevVeh()})}catch{document.getElementById("online").innerHTML="?/?",document.getElementById("text").innerHTML="No information yet",document.getElementById("impprev").src=""}}var MAPstatic={"*":[],B:[],Z:[],G:[],S:[],_:[],CT:{weather:"Clear",sf:"#000",ss:"#000",bg:"#000",zs:"#000",zf:"#000",bf:"#000",bs:"#000",gf:"#000",gs:"#000",o0:"#000",o1:"#000",l0:"#000",l1:"#000",b0:"#000",b1:"#000",b2:"#000",fs:"rgba(0,0,0,0)",os:"rgba(0,0,0,0)"}};let Zoom=320,currentZoom=320,socket=null,curView=0,Xmod=!1,Cmod=!1,LoadScrHidn=!1,ShakeXbnds=0,ShakeYbnds=0,SENDB="",SENDS="",X=16,Y=16,nX=16,Z=0,speed=0,nY=16,Deg=0,newDeg=0,vehicle=0,WH=32,OffsetX=0,OffsetY=0;document.getElementById("VolumeRange").value=localStorage.getItem("SettingsVolumeRangeVal"),document.getElementById("MusicRange").value=localStorage.getItem("SettingsMusicRangeVal"),UpdtVolumes();let MSGTKNDT=new Date,FPS=30,PING=0,LastPING=Date.now(),Send=!1,hp=document.getElementById("HPNum"),ZonesNum=document.getElementById("Zones"),moneyb=document.getElementById("MoneyB"),gasnum=document.getElementById("GasNum"),spdnum=document.getElementById("SpdNum"),dirnum=document.getElementById("DirNum"),tornum=document.getElementById("TorNum"),aarnum=document.getElementById("AARocketNum"),bmbnum=document.getElementById("BombNum"),carrynum=document.getElementById("CarryNum"),smknum=document.getElementById("SmkNum"),tracernum=document.getElementById("TracerNum"),num120=document.getElementById("Num120"),num45=document.getElementById("Num45"),num20=document.getElementById("Num20"),num8=document.getElementById("Num8"),xmodnum=document.getElementById("XmodNum"),cmodnum=document.getElementById("CmodNum"),PlayerMark=document.getElementById("PlayerMark"),xnum=document.getElementById("XNum"),ynum=document.getElementById("YNum"),canvas=document.getElementById("MainCanvas"),chatview=document.getElementById("ChatView"),map=document.getElementById("MapForm"),mapimg=document.getElementById("Map"),tab=document.getElementById("TabForm"),moneys=document.getElementById("MoneyB"),nicknameinput=document.getElementById("NameField"),messageinput=document.getElementById("MessageFieldTxt");messageinput.onkeydown=function(e){(9==e.keyCode||17==e.keyCode)&&("Global"==messagebtn.innerText?messagebtn.innerText="Team":messagebtn.innerText="Global")};let messagefield=document.getElementById("MessageField"),messagebtn=document.getElementById("MessageFieldBtn"),mapimgwh=100,mapimgrect=null,ctx=canvas.getContext("2d");ctx.globalCompositeOperation="xor",resize();let BURNING=!1;WtrParticles0=[];let RainParticles0=[],RainParticles0max=500,SnowParticles0=[],SnowParticles0max=100,FireParticles0=[],FireParticles1=[],FireParticles2=[],RocketTraceParticles=[],CanBangParticles0=[],CanBangParticles1=[],FireParticles0max=20,FireParticles0speed=.25,FireParticles0size=3,WtrBangParticles0=[],BangParticles0=[],BangParticles1=[],BangParticles2=[],SmokeParticles0=[],SmokeParticles0rate=60,TracerParticles1=[];function changeColor(){sessionStorage.setItem("SelectedCL",document.querySelector('input[name="color"]:checked').value)}try{document.querySelector('input[name="color"][value="'+sessionStorage.getItem("SelectedCL")+'"]').checked=!0}catch{}let MSGs=[],ammo=new Map;ammo.set("120mm",0),ammo.set("45mm",0),ammo.set("20mm",0),ammo.set("8mm",0);let input=new Map;input.set(87,!1),input.set(65,!1),input.set(83,!1),input.set(68,!1),input.set(32,!1),input.set(71,!1),input.set("Tab",!1),input.set("m0",!1);let dobleinput=new Map;dobleinput.set(87,!1),dobleinput.set(65,!1),dobleinput.set(83,!1),dobleinput.set(68,!1),dobleinput.set(32,!1),dobleinput.set(71,!1),dobleinput.set("m0",!1);let mouseX=0,mouseY=0,INFO="",MAP=new Map;function startgame(){document.getElementById("chk-game").checked=!0,GameStatus="InGame",PIXI.sound.stop("MainMenuMusic"),canvas.addEventListener("mousedown",mclick,!1),document.addEventListener("mouseup",mrelease,!1),document.addEventListener("mousemove",mousepos,!1),document.addEventListener("fullscreenchange",fresize),document.addEventListener("keydown",keydown),document.addEventListener("keyup",keyup),messagefield.addEventListener("focusout",mifo),document.addEventListener("wheel",onWheel);try{(socket=new WebSocket(document.getElementById("ServerAddress").value)).addEventListener("open",function(e){socket.send("n"+nicknameinput.value+"\n"+document.querySelector('input[name="color"]:checked').value+"\n"+document.getElementById("VehicleSelect").value+"\n"+document.getElementById("NICK").innerText+"\n"+document.getElementById("PASS").innerText),vehicle=Number(document.getElementById("VehicleSelect").value)}),socket.addEventListener("message",function e(t){if("E"==t.data[0])GameStatus="Error",document.getElementById("TitleScreen").classList=["titlescrh"],document.getElementById("chkInterfaceHide").checked=!1,alert(t.data.split(",")[1]);else if("M"==t.data[0]){document.getElementById("TitleScreen").classList=["titlescrh"];var a=new XMLHttpRequest;a.open("GET",t.data.substring(1),!1),a.send(null),WH=(MAPstatic=JSON.parse(a.responseText)).WH,ZonesNum.innerHTML="";for(let s=0;s<MAPstatic["*"].length;s++)ZonesNum.innerHTML+='<div class="Zone" style="background-color: red" id="zone'+s+'"><b>'+MAPstatic["*"][s][0]+"</b></div>";socket.send((input.get("m0")||dobleinput.get("m0")?1:0).toString()+(input.get(87)||dobleinput.get(87)?1:0).toString()+(input.get(65)||dobleinput.get(65)?1:0).toString()+(input.get(83)||dobleinput.get(83)?1:0).toString()+(input.get(68)||dobleinput.get(68)?1:0).toString()+(input.get(32)||dobleinput.get(32)?1:0).toString()+(input.get(71)||dobleinput.get(71)?1:0).toString()+(input.get("Tab")?1:0).toString()+(Cmod?1:0).toString()+(Xmod?1:0).toString()+curView.toString()+((mouseX-GameW/2/window.devicePixelRatio)/Zoom).toString()+","+((mouseY-GameH/2/window.devicePixelRatio)/Zoom).toString())}else if("D"==t.data[0]){GameStatus="MainMenu",PlayersData=new Map,PIXI.sound.play("MainMenuMusic");let l=document.getElementById("Inventory").children;for(let n=0;n<l.length;n++)l[n].style.display="none";document.getElementById("chk-game").checked=!1,document.getElementById("chkInterfaceHide").checked=!1,chatview.innerHTML="",StartMainMusicPlay=Date.now(),Players=[],socket.close()}else if("R"==t.data[0])socket.close(),SaveMusicPos(),location.replace(t.data.slice(1));else{MSGTKNDT=new Date,INFO=t.data,PING=Date.now()-LastPING,LastPING=Date.now();let o=INFO.split("\n");Players=[],splstr=o[0].split(","),PlayerTags=new Map,PlayerName=splstr[1],CurVehicle=splstr[0],Money=splstr[2],Zones=splstr[splstr.length-1].toString();for(let i=0;i<Zones.length;i++){let r=document.getElementById("zone"+i.toString());"1"==Zones[i]?r.style.background="#44f":r.style.background="#f00"}argarr=[];for(let c=3;c<splstr.length;c++)argarr.push(splstr[c]);""==PlayerName||void 0==PlayerName||(PlayerName=splstr[1].split("]")[splstr[1].split("]").Count-1],Players.push([PlayerName,CurVehicle]),Vehicles[CurVehicle].updatep(NoTeamTag(PlayerName),argarr)),null!=moneyb&&(moneyb.innerText=Money),PlayerMark.style.left=(X/WH*100).toString()+"%",PlayerMark.style.top=(Y/WH*100).toString()+"%",o[0].split(",")[6];for(let $=1;$<o.length;$++){let m=o[$].split(",");if("k"==m[0]){if(-1==MSGs.indexOf(Number(m[3]))){let P=document.createElement("div");P.className="MSGk",P.innerHTML="<b>"+m[1]+"</b> destroyed <b>"+m[2]+"</b>",chatview.append(P),MSGs.push(Number(m[3]))}}else if("l"==m[0]){if(-1==MSGs.indexOf(Number(m[2]))){let g=document.createElement("div");g.className="MSGl",g.innerHTML=m[1],chatview.append(g),MSGs.push(Number(m[2]))}}else if("+"==m[0]){PN=m[1],CV=m[2],argarr=[];for(let d=3;d<m.length;d++)argarr.push(m[d]);""==PN||void 0==PN||(Players.push([PN,CV]),Vehicles[CV].update(NoTeamTag(PN),argarr))}else if("a"==m[0])ammo.set("120mm",Number(m[1])),ammo.set("45mm",Number(m[2])),ammo.set("20mm",Number(m[3])),ammo.set("8mm",Number(m[4])),num120.innerHTML="<span>120mm</span>"+m[1],num45.innerHTML="<span>45mm</span>"+m[2],num20.innerHTML="<span>20mm</span>"+m[3],num8.innerHTML="<span>8mm</span>"+m[4],"0"==m[1]?num120.className="unselectable ammonum NumAmmo0":num120.className="unselectable ammonum NumAmmo","0"==m[2]?num45.className="unselectable ammonum NumAmmo0":num45.className="unselectable ammonum NumAmmo","0"==m[3]?num20.className="unselectable ammonum NumAmmo0":num20.className="unselectable ammonum NumAmmo","0"==m[4]?num8.className="unselectable ammonum NumAmmo0":num8.className="unselectable ammonum NumAmmo";else if("g"==m[0]&&m.length>3){if(-1==MSGs.indexOf(Number(m[3]))){let f=document.createElement("div");f.className="crewMSG",f.innerHTML="<b>"+m[1]+"</b> "+m[2],chatview.append(f),f.scrollIntoView(),MSGs.push(Number(m[3]))}}else if("c"==m[0]){if(-1==MSGs.indexOf(Number(m[1]))){if(0==Number(m[2])){let u=document.createElement("div");u.className="TeamMSG",u.innerHTML="Requested to join <b>"+m[3]+"</b>",chatview.append(u),MSGs.push(Number(m[1]))}else if("1"==m[2]){let y=document.createElement("div");y.className="ErrMSG",y.innerHTML="No such team !",chatview.append(y),MSGs.push(Number(m[1]))}else if("2"==m[2]){let G=document.createElement("div");G.className="ErrMSG",G.innerHTML="You are already in team, if you want to leave type <b>/team leave</b> !",chatview.append(G),MSGs.push(Number(m[1]))}else if("3"==m[2]){let I=document.createElement("div");I.className="ErrMSG",I.innerHTML="Team <b>"+m[3]+"</b> already exists !",chatview.append(I),MSGs.push(Number(m[1]))}else if("4"==m[2]){let p=document.createElement("div");p.className="TeamMSG",p.innerHTML="Team <b>"+m[3]+"</b> was successfully created !",chatview.append(p),MSGs.push(Number(m[1]))}else if("5"==m[2]){let h=document.createElement("div");h.className="ErrMSG",h.innerHTML="You are alone, you can't leave team !",chatview.append(h),MSGs.push(Number(m[1]))}else if("6"==m[2]){let B=document.createElement("div");B.className="ErrMSG",B.innerHTML="No permission to use this command !",chatview.append(B),MSGs.push(Number(m[1]))}else if("7"==m[2]){let N=document.createElement("div");N.className="ErrMSG",N.innerHTML="You can't kick yourself, use <b>/team leave</b> !",chatview.append(N),MSGs.push(Number(m[1]))}else if("8"==m[2]){let x=document.createElement("div");x.className="KickMSG",x.innerHTML="Player <b>"+m[3]+"</b> was kicked from team",chatview.append(x),MSGs.push(Number(m[1]))}else if("9"==m[2]){let S=document.createElement("div");S.className="KickMSG",S.innerHTML="Welcome the new team member <b>"+m[3]+"</b>",chatview.append(S),MSGs.push(Number(m[1]))}else if("a"==m[2]){let w=document.createElement("div");w.className="ErrMSG",w.innerHTML="You are alone, you have no teammates !",chatview.append(w),MSGs.push(Number(m[1]))}else if("b"==m[2]){let T=document.createElement("div");T.className="TeamMSG",T.innerHTML="You succesfully left team !",chatview.append(T),MSGs.push(Number(m[1]))}}}else if("m"==m[0]){if(-1==MSGs.indexOf(Number(m[3]))){let k=document.createElement("div");"[SERVER]"==m[1]?k.className="ServerMSG":k.className="MSG",m[1].split("]").length>1&&"[SERVER]"!=m[1]?k.innerHTML="<b><a onclick=\"Send = true;messagebtn.innerText = 'Global'; messageinput.value = '/team join "+m[1].split("]")[0].slice(1)+"';\">["+m[1].split("]")[0].slice(1)+"]</a>"+m[1].split("]")[1]+"</b> "+m[2]:k.innerHTML="<b>"+m[1]+"</b> "+m[2],chatview.append(k),k.scrollIntoView(),MSGs.push(Number(m[3]))}}else if("p"==m[0]){if(m.length>3)SmokesData.has(m[1])||SmokesData.set(m[1],[Number(m[2]),Number(m[3]),Date.now(),!1,[]]);else try{SmokesData.get(m[1])[3]=!0}catch{}}else if("b"==m[0]){if(m.length>3)BombsData.has(m[1])||BombsData.set(m[1],[Number(m[2]),Number(m[3]),Number(m[4]),Number(m[5]),Number(m[6]),Number(m[7]),Date.now(),!1,Number(m[8])]);else try{BombsData.get(m[1])[4]=m[2],BombsData.get(m[1])[7]=!0}catch{}}else if("r"==m[0]){if(m.length>3)AARocketsData.has(m[1])||AARocketsData.set(m[1],[Number(m[2]),Number(m[3]),Number(m[4]),Number(m[5]),Number(m[6]),!1,Number(m[2])-Math.cos(Number(m[4])/180*Math.PI)*Number(m[6])*PING/1e3*3,Number(m[3])-Math.sin(Number(m[4])/180*Math.PI)*Number(m[6])*PING/1e3*3,Date.now()-1.5*PING,Number(m[7])]);else try{AARocketsData.get(m[1])[3]=m[2],AARocketsData.get(m[1])[5]=!0}catch{}}else if("<"==m[0]){if(m.length>3)TorpedosData.has(m[1])||TorpedosData.set(m[1],[Number(m[2]),Number(m[3]),Number(m[4]),Number(m[5]),Number(m[6]),!1,Number(m[2])-Math.cos(Number(m[4])/180*Math.PI)*Number(m[6])*PING/1e3*3,Number(m[3])-Math.sin(Number(m[4])/180*Math.PI)*Number(m[6])*PING/1e3*3,Date.now()]);else try{TorpedosData.get(m[1])[3]=m[2],TorpedosData.get(m[1])[5]=!0}catch{}}else if(">"==m[0]){if(m.length>3)BulletsData.has(m[1])||BulletsData.set(m[1],[Number(m[2]),Number(m[3]),Number(m[4]),Number(m[5]),Number(m[6]),Number(m[7]),Number(m[8]),!1,Number(m[2]),Number(m[3]),Date.now(),0]);else try{BulletsData.get(m[1])[3]=m[2],BulletsData.get(m[1])[7]=!0}catch{}}else if("j"==m[0]){if(-1==MSGs.indexOf(Number(m[2]))){let D=document.createElement("div");D.className="MSGj",D.innerHTML='<img src="static/checkmark.svg" onclick="Send = true; messageinput.value = \'/team accept '+m[1]+"'; this.parentNode.remove()\">   "+m[1],chatview.append(D),D.scrollIntoView(),MSGs.push(Number(m[2]))}}else if("t"==m[0]){tab.innerHTML="";let v=document.createElement("table");for(let L=1;L<m.length;L+=2)m[L].split("]").length>1?v.innerHTML+='    <tr class="bg'+(L-1)/2%2+"\">\n        <td><b><a onclick=\"Send = true;messagebtn.innerText = 'Global'; messageinput.value = '/team join "+m[L].split("]")[0].slice(1)+"';\">["+m[L].split("]")[0].slice(1)+"]</a>"+m[L].split("]")[1]+'</b></td>\n        <td class="td2"><b>'+m[L+1]+"</b></td>\n    </tr>":v.innerHTML+='    <tr class="bg'+(L-1)/2%2+'">\n        <td><b>'+m[L]+'</b></td>\n        <td class="td2"><b>'+m[L+1]+"</b></td>\n    </tr>";tab.appendChild(v),input.set("Tab",!1)}}for(var[A,M]of(dellarr=[],PlayersData)){for(_ of(b=!0,Players))NoTeamTag(_[0])==A&&(b=!1);b&&dellarr.push(A)}for(;dellarr.length>0;)PlayersData.delete(dellarr[0]),dellarr.shift();console.log(window.devicePixelRatio),!0==Send?("Team"==messagebtn.innerText?socket.send((input.get("m0")||dobleinput.get("m0")?1:0).toString()+(input.get(87)||dobleinput.get(87)?1:0).toString()+(input.get(65)||dobleinput.get(65)?1:0).toString()+(input.get(83)||dobleinput.get(83)?1:0).toString()+(input.get(68)||dobleinput.get(68)?1:0).toString()+(input.get(32)||dobleinput.get(32)?1:0).toString()+(input.get(71)||dobleinput.get(71)?1:0).toString()+(input.get("Tab")?1:0).toString()+(Cmod?1:0).toString()+(Xmod?1:0).toString()+curView.toString()+((mouseX-GameW/2/window.devicePixelRatio)/Zoom).toString()+","+((mouseY-GameH/2/window.devicePixelRatio)/Zoom).toString()+",m/team chat "+messageinput.value):socket.send((input.get("m0")||dobleinput.get("m0")?1:0).toString()+(input.get(87)||dobleinput.get(87)?1:0).toString()+(input.get(65)||dobleinput.get(65)?1:0).toString()+(input.get(83)||dobleinput.get(83)?1:0).toString()+(input.get(68)||dobleinput.get(68)?1:0).toString()+(input.get(32)||dobleinput.get(32)?1:0).toString()+(input.get(71)||dobleinput.get(71)?1:0).toString()+(input.get("Tab")?1:0).toString()+(Cmod?1:0).toString()+(Xmod?1:0).toString()+curView.toString()+((mouseX-GameW/2/window.devicePixelRatio)/Zoom).toString()+","+((mouseY-GameH/2/window.devicePixelRatio)/Zoom).toString()+",m"+messageinput.value),messageinput.value="",Send=!1):socket.send((input.get("m0")||dobleinput.get("m0")?1:0).toString()+(input.get(87)||dobleinput.get(87)?1:0).toString()+(input.get(65)||dobleinput.get(65)?1:0).toString()+(input.get(83)||dobleinput.get(83)?1:0).toString()+(input.get(68)||dobleinput.get(68)?1:0).toString()+(input.get(32)||dobleinput.get(32)?1:0).toString()+(input.get(71)||dobleinput.get(71)?1:0).toString()+(input.get("Tab")?1:0).toString()+(Cmod?1:0).toString()+(Xmod?1:0).toString()+curView.toString()+((mouseX-GameW/2/window.devicePixelRatio)/Zoom*window.devicePixelRatio).toString()+","+((mouseY-GameH/2/window.devicePixelRatio)/Zoom*window.devicePixelRatio).toString()),SENDB="",SENDS="",dobleinput.set(87,!1),dobleinput.set(65,!1),dobleinput.set(83,!1),dobleinput.set(68,!1),dobleinput.set(32,!1),dobleinput.set(71,!1),dobleinput.set("m0",!1),input.set("Tab",!1)}}),socket.onerror=function(e){document.getElementById("TitleScreen").classList=["titlescrh"],document.getElementById("chkInterfaceHide").checked=!1,console.log("ERROR")}}catch(e){console.log(e,e.stack)}}function lookat(e,t){0==e&&(e=.001);let a=Math.atan(t/e)/(Math.PI/180);return t!=Math.abs(t)&&(a+=360),e!=Math.abs(e)&&(a+=180),a-=360*Math.floor(a/360)}function resize(){GameW=window.innerWidth*window.devicePixelRatio,GameH=window.innerHeight*window.devicePixelRatio,canvas.width=window.innerWidth*window.devicePixelRatio,canvas.height=window.innerHeight*window.devicePixelRatio,canvas.style.width=window.innerWidth+"px",canvas.style.height=window.innerHeight+"px",ZoomCorrection()}function fresize(){GameW=window.innerWidth*window.devicePixelRatio,GameH=window.innerHeight*window.devicePixelRatio,canvas.width=window.innerWidth*window.devicePixelRatio,canvas.height=window.innerHeight*window.devicePixelRatio,canvas.style.width=window.innerWidth+"px",canvas.style.height=window.innerHeight+"px",ZoomCorrection()}function mclick(){input.set("m0",!0),dobleinput.set("m0",!0)}function mrelease(){input.set("m0",!1)}function mifo(){messagefield.style.display="none"}function keydown(e){"none"==messagefield.style.display&&(87==e.keyCode||65==e.keyCode||83==e.keyCode||68==e.keyCode||32==e.keyCode||71==e.keyCode)?(input.set(e.keyCode,!0),dobleinput.set(e.keyCode,!0)):"Enter"==e.key&&"InGame"==GameStatus?"none"==messagefield.style.display?(messagefield.style.display="block",messageinput.focus()):(messagefield.style.display="none",Send=!0):113==e.keyCode?(document.getElementById("chkInterfaceHide").checked=!document.getElementById("chkInterfaceHide").checked,cameraMode=document.getElementById("chkInterfaceHide").checked):114==e.keyCode?"crosshair"==document.getElementById("MainCanvas").style.cursor?document.getElementById("MainCanvas").style.cursor="none":document.getElementById("MainCanvas").style.cursor="crosshair":86==e.keyCode?(curView=(curView+1)%Vehicles[CurVehicle].views,document.getElementById("ViewImg").src=Vehicles[CurVehicle].viewsIcons[curView]):"none"==messagefield.style.display&&77==e.keyCode?map.style.display="block":"none"==messagefield.style.display&&9==e.keyCode?(input.set("Tab",!0),tab.style.display="block"):"none"==messagefield.style.display&&67==e.keyCode?(Cmod=!Cmod,cmodnum.src="./static/Cmodinv"+(Cmod?1:0).toString()+".svg",tracernum.src="./static/Tracerinv"+(Cmod?1:0).toString()+".svg"):"none"==messagefield.style.display&&88==e.keyCode&&(Xmod=!Xmod,xmodnum.src="./static/Xmodinv"+(Xmod?1:0).toString()+".svg")}function keyup(e){87==e.keyCode||65==e.keyCode||83==e.keyCode||68==e.keyCode||32==e.keyCode||71==e.keyCode?input.set(e.keyCode,!1):77==e.keyCode?map.style.display="none":9==e.keyCode&&(tab.style.display="none")}MAP.set("b",new Map),MAP.set("s",new Map),MAP.set("z",new Map),MAP.set("g",new Map);let start=null,timenow=Date.now();function DRAW(e){try{if("InGame"==GameStatus){if("Snow"==MAPstatic.CT.weather){if(0==SnowParticles0.length)for(var t=0;t<SnowParticles0max;t++)SnowParticles0.push(new Particle2(canvas.width,canvas.height))}else SnowParticles0.length>0&&(SnowParticles0=[])}else RainParticles0.length>0&&(RainParticles0=[]);for(let a of(timenow=Date.now(),BURNING&&(ShakeXbnds+=.25,ShakeYbnds+=.25),ShakeXbnds*=.9,ShakeYbnds*=.9,OffsetX=Math.random()*ShakeXbnds-ShakeXbnds/2,OffsetY=Math.random()*ShakeYbnds-ShakeYbnds/2,LastFPS=Date.now(),FPS=1e3/(Date.now()-LastAnime),LastAnime=Date.now(),start||(start=e),ctx.clearRect(0,0,canvas.width,canvas.height),ctx.fillStyle=MAPstatic.CT.bg,ctx.fillRect(0,0,canvas.width,canvas.height),ctx.fill(),MAPstatic.B)){ctx.strokeStyle=MAPstatic.CT.zs,ctx.lineJoin="bevel",ctx.beginPath(),ctx.lineWidth=.5*Zoom;for(let s=0;s<a.length;s+=1)0==s?ctx.moveTo(GameW/2+OffsetX-(X-a[0][0]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-a[0][1]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom):ctx.lineTo(GameW/2+OffsetX-(X-a[s][0]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-a[s][1]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom);ctx.closePath(),ctx.stroke()}for(let l of MAPstatic.S){ctx.strokeStyle=MAPstatic.CT.zs,ctx.lineJoin="bevel",ctx.beginPath(),ctx.lineWidth=.25*Zoom;for(let n=0;n<l.length;n+=1)0==n?ctx.moveTo(GameW/2+OffsetX-(X-l[0][0]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-l[0][1]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom):ctx.lineTo(GameW/2+OffsetX-(X-l[n][0]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-l[n][1]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom);ctx.closePath(),ctx.stroke()}for(let o of MAPstatic.B){ctx.strokeStyle=MAPstatic.CT.zf,ctx.lineJoin="bevel",ctx.beginPath(),ctx.lineWidth=.25*Zoom;for(let i=0;i<o.length;i+=1)0==i?ctx.moveTo(GameW/2+OffsetX-(X-o[0][0]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-o[0][1]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom):ctx.lineTo(GameW/2+OffsetX-(X-o[i][0]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-o[i][1]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom);ctx.closePath(),ctx.stroke()}for(let r of MAPstatic.S){ctx.strokeStyle=MAPstatic.CT.zf,ctx.lineJoin="bevel",ctx.beginPath(),ctx.lineWidth=.125*Zoom;for(let c=0;c<r.length;c+=1)0==c?ctx.moveTo(GameW/2+OffsetX-(X-r[0][0]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-r[0][1]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom):ctx.lineTo(GameW/2+OffsetX-(X-r[c][0]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-r[c][1]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom);ctx.closePath(),ctx.stroke()}for(let $=0;$<Players.length;$++)Players[$][0]==PlayerName?Vehicles[Players[$][1]].drawp("UnderWater-2",NoTeamTag(Players[$][0])):Vehicles[Players[$][1]].draw("UnderWater-2",NoTeamTag(Players[$][0]));for(let m=0;m<Players.length;m++)Players[m][0]==PlayerName?Vehicles[Players[m][1]].drawp("UnderWater-1",NoTeamTag(Players[m][0])):Vehicles[Players[m][1]].draw("UnderWater-1",NoTeamTag(Players[m][0]));for(let P=0;P<Players.length;P++)Players[P][0]==PlayerName?Vehicles[Players[P][1]].drawp("UnderWater",NoTeamTag(Players[P][0])):Vehicles[Players[P][1]].draw("UnderWater",NoTeamTag(Players[P][0]));for(let g=0;g<Players.length;g++)Players[g][0]==PlayerName?Vehicles[Players[g][1]].drawp("UnderWater+1",NoTeamTag(Players[g][0])):Vehicles[Players[g][1]].draw("UnderWater+1",NoTeamTag(Players[g][0]));for(let d=0;d<Players.length;d++)Players[d][0]==PlayerName?Vehicles[Players[d][1]].drawp("UnderWater+2",NoTeamTag(Players[d][0])):Vehicles[Players[d][1]].draw("UnderWater+2",NoTeamTag(Players[d][0]));if(ParticlesProcessing)for(t=0;t<WtrParticles0.length;t++)ctx.fillStyle="rgba(255,255,255,"+WtrParticles0[t].life**1.5*.25+")",ctx.beginPath(),ctx.arc(OffsetX+(WtrParticles0[t].x-(X+(nX-X)*((Date.now()-LastPING)/PING)))*Zoom+GameW/2,OffsetY+GameH/2+(WtrParticles0[t].y-(Y+(nY-Y)*((Date.now()-LastPING)/PING)))*Zoom,((WtrParticles0[t].rad-WtrParticles0[t].life*WtrParticles0[t].rad)/320*Zoom*7.5+2.5)/320*Zoom,0,2*Math.PI),ctx.fill(),WtrParticles0[t].life*=.99,WtrParticles0[t].life<.15&&(WtrParticles0.splice(t,1),t--);else WtrParticles0=[];for(let f of TorpedosData.keys()){if(1==TorpedosData.get(f)[3]){TorpedosData.get(f)[3]=0,PIXI.sound.play("wtrBang");for(let u=0;u<5;u++)WtrBangParticles0.push(new BangPrt0(TorpedosData.get(f)[0],TorpedosData.get(f)[1]));ShakeXbnds+=10,ShakeYbnds+=10}else 2==TorpedosData.get(f)[3]&&(PIXI.sound.play("lnchTrpd"),TorpedosData.get(f)[3]=0);grad=ctx.createLinearGradient(GameW/2+OffsetX-(X-TorpedosData.get(f)[0]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-TorpedosData.get(f)[1]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom,GameW/2+OffsetX-(X-TorpedosData.get(f)[0]+Math.cos(TorpedosData.get(f)[2]/180*Math.PI)*TorpedosData.get(f)[4]/3+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-TorpedosData.get(f)[1]+Math.sin(TorpedosData.get(f)[2]/180*Math.PI)*TorpedosData.get(f)[4]/3+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom),.15>Math.random()&&WtrParticles0.push(new WtrPrt0(TorpedosData.get(f)[0],TorpedosData.get(f)[1])),grad.addColorStop(1,"#FFFFFF00"),grad.addColorStop(0,"#FFFFff88"),ctx.strokeStyle=grad,ctx.lineWidth=.025*Zoom,ctx.beginPath(),ctx.lineCap="round",ctx.moveTo(GameW/2+OffsetX-(X-TorpedosData.get(f)[0]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-TorpedosData.get(f)[1]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom),ctx.lineTo(GameW/2+OffsetX-(X-TorpedosData.get(f)[0]+Math.cos(TorpedosData.get(f)[2]/180*Math.PI)*TorpedosData.get(f)[4]/3/320*Zoom+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-TorpedosData.get(f)[1]+Math.sin(TorpedosData.get(f)[2]/180*Math.PI)*TorpedosData.get(f)[4]/3/320*Zoom+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom),ctx.stroke(),ctx.closePath(),TorpedosData.get(f)[0]=TorpedosData.get(f)[6]+Math.cos(TorpedosData.get(f)[2]/180*Math.PI)*TorpedosData.get(f)[4]*(Date.now()-TorpedosData.get(f)[8])/1e3,TorpedosData.get(f)[1]=TorpedosData.get(f)[7]+Math.sin(TorpedosData.get(f)[2]/180*Math.PI)*TorpedosData.get(f)[4]*(Date.now()-TorpedosData.get(f)[8])/1e3,(TorpedosData.get(f)[5]||TorpedosData.get(f)[0]>20||TorpedosData.get(f)[0]<-4||TorpedosData.get(f)[1]>19||TorpedosData.get(f)[1]<-4)&&TorpedosData.delete(f)}for(let y of MAPstatic._)ctx.beginPath(),ctx.moveTo(GameW/2+OffsetX-(X-y[0]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-y[1]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom),ctx.lineTo(GameW/2+OffsetX-(X-y[2]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-y[3]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom),ctx.closePath(),ctx.strokeStyle=MAPstatic.CT.b2,ctx.lineCap="square",ctx.lineWidth=70/320*Zoom,ctx.stroke();for(let G of MAPstatic.B){ctx.fillStyle=MAPstatic.CT.bf,ctx.strokeStyle=MAPstatic.CT.bs,ctx.lineJoin="bevel",ctx.beginPath();for(let I=0;I<G.length;I+=1)0==I?ctx.moveTo(GameW/2+OffsetX-(X-G[0][0]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-G[0][1]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom):ctx.lineTo(GameW/2+OffsetX-(X-G[I][0]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-G[I][1]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom);ctx.closePath(),ctx.lineWidth=((Math.sin(timenow/50/180*Math.PI)+1)*5+2)/320*Zoom,ctx.fill(),ctx.stroke()}for(let p of MAPstatic.G){ctx.fillStyle=MAPstatic.CT.gf,ctx.strokeStyle=MAPstatic.CT.gs,ctx.lineWidth=10/320*Zoom,ctx.lineJoin="bevel",ctx.beginPath();for(let h=0;h<p.length;h+=1)0==h?ctx.moveTo(GameW/2+OffsetX-(X-p[0][0]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-p[0][1]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom):ctx.lineTo(GameW/2+OffsetX-(X-p[h][0]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-p[h][1]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom);ctx.closePath(),ctx.fill(),ctx.stroke()}for(let B=0;B<MAPstatic["*"].length;B++)ctx.lineWidth=10/320*Zoom,"0"==Zones[B]?(ctx.strokeStyle="rgba(255,0,0,0.25)",ctx.fillStyle="rgba(255,0,0,0.25)"):(ctx.strokeStyle="rgba(0,0,255,0.25)",ctx.fillStyle="rgba(0,0,255,0.25)"),ctx.textAlign="center",ctx.font=(.9375*Zoom).toString()+"px ZCOOL QingKe HuangYou",ctx.beginPath(),ctx.arc(GameW/2+OffsetX-(X-MAPstatic["*"][B][1]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-MAPstatic["*"][B][2]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom,.5*Zoom,0,2*Math.PI),ctx.fillText(MAPstatic["*"][B][0],GameW/2+OffsetX-(X-MAPstatic["*"][B][1]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-MAPstatic["*"][B][2]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom+.3125*Zoom),ctx.closePath(),ctx.stroke();ctx.lineWidth=5,ctx.beginPath(),ctx.rect(GameW/2+OffsetX-(X+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom,WH*Zoom,WH*Zoom),ctx.closePath(),ctx.strokeStyle="#ff0000ff",ctx.stroke();for(let N=0;N<Players.length;N++)Players[N][0]==PlayerName?Vehicles[Players[N][1]].drawp("OnWater-2",NoTeamTag(Players[N][0])):Vehicles[Players[N][1]].draw("OnWater-2",NoTeamTag(Players[N][0]));for(let x=0;x<Players.length;x++)Players[x][0]==PlayerName?Vehicles[Players[x][1]].drawp("OnWater-1",NoTeamTag(Players[x][0])):Vehicles[Players[x][1]].draw("OnWater-1",NoTeamTag(Players[x][0]));for(let S=0;S<Players.length;S++)Players[S][0]==PlayerName?Vehicles[Players[S][1]].drawp("OnWater",NoTeamTag(Players[S][0])):Vehicles[Players[S][1]].draw("OnWater",NoTeamTag(Players[S][0]));for(let w=0;w<Players.length;w++)Players[w][0]==PlayerName?Vehicles[Players[w][1]].drawp("OnWater+1",NoTeamTag(Players[w][0])):Vehicles[Players[w][1]].draw("OnWater+1",NoTeamTag(Players[w][0]));for(let T=0;T<Players.length;T++)Players[T][0]==PlayerName?Vehicles[Players[T][1]].drawp("OnWater+2",NoTeamTag(Players[T][0])):Vehicles[Players[T][1]].draw("OnWater+2",NoTeamTag(Players[T][0]));for(t=0;t<CanBangParticles0.length;t++)ctx.fillStyle="rgba(192,192,192,"+CanBangParticles0[t].life**1.5*1+")",ctx.beginPath(),ctx.arc(OffsetX+(CanBangParticles0[t].x-(X+(nX-X)*((Date.now()-LastPING)/PING)))*Zoom+GameW/2,OffsetY+GameH/2+(CanBangParticles0[t].y-(Y+(nY-Y)*((Date.now()-LastPING)/PING)))*Zoom,CanBangParticles0[t].rad/320*Zoom,0,2*Math.PI),ctx.closePath(),CanBangParticles0[t].x+=CanBangParticles0[t].xs/10*CanBangParticles0[t].life/320,CanBangParticles0[t].y+=CanBangParticles0[t].ys/10*CanBangParticles0[t].life/320,CanBangParticles0[t].rad+=.1*CanBangParticles0[t].life/320*Zoom,ctx.fill(),CanBangParticles0[t].life*=.99,CanBangParticles0[t].life<.001&&(CanBangParticles0.splice(t,1),t--);if(ParticlesProcessing)for(t=FireParticles0.length-1;t>=0;t--)ctx.fillStyle="rgba(255,"+255*FireParticles0[t].life/60+","+255*(FireParticles0[t].life/60)**3+","+.75*Math.sin(FireParticles0[t].life/60*Math.PI)+")",ctx.beginPath(),ctx.arc(OffsetX+(FireParticles0[t].x-(X+(nX-X)*((Date.now()-LastPING)/PING)))*Zoom+GameW/2-FireParticles0[t].cof*Math.cos(FireParticles0[t].dir)*FireParticles0[t].rad/320*Zoom,OffsetY+GameH/2+(FireParticles0[t].y-(Y+(nY-Y)*((Date.now()-LastPING)/PING)))*Zoom-FireParticles0[t].cof*Math.sin(FireParticles0[t].dir)*FireParticles0[t].rad/320*Zoom,FireParticles0[t].rad*Math.sin(FireParticles0[t].life/60*Math.PI)/320*Zoom,0,2*Math.PI),ctx.closePath(),ctx.fill(),FireParticles0[t].dirspd+=(2*Math.random()-1)*.03,FireParticles0[t].dir+=FireParticles0[t].dirspd,FireParticles0[t].x+=Math.cos(FireParticles0[t].deg)*FireParticles0[t].speed*Math.sin(FireParticles0[t].life/60*Math.PI)*(1-FireParticles0[t].life/60)/320,FireParticles0[t].y+=Math.sin(FireParticles0[t].deg)*FireParticles0[t].speed*Math.sin(FireParticles0[t].life/60*Math.PI)*(1-FireParticles0[t].life/60)/320,FireParticles0[t].life*=.95,FireParticles0[t].life<5&&(FireParticles0.splice(t,1),t--);else FireParticles0=[];if(Z>0)for(let k of MAPstatic._)ctx.beginPath(),ctx.moveTo(GameW/2+OffsetX-(X-k[0]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-k[1]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom),ctx.lineTo(GameW/2+OffsetX-(X-k[2]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-k[3]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom),ctx.closePath(),ctx.lineCap="square",ctx.strokeStyle=MAPstatic.CT.b1,ctx.lineWidth=.1875*Zoom,ctx.stroke(),ctx.strokeStyle=MAPstatic.CT.b0,ctx.lineWidth=50/320*Zoom,ctx.stroke();for(let D=0;D<Players.length;D++)Players[D][0]==PlayerName?Vehicles[Players[D][1]].drawp("OnGround-2",NoTeamTag(Players[D][0])):Vehicles[Players[D][1]].draw("OnGround-2",NoTeamTag(Players[D][0]));for(let v=0;v<Players.length;v++)Players[v][0]==PlayerName?Vehicles[Players[v][1]].drawp("OnGround-1",NoTeamTag(Players[v][0])):Vehicles[Players[v][1]].draw("OnGround-1",NoTeamTag(Players[v][0]));for(let L=0;L<Players.length;L++)Players[L][0]==PlayerName?Vehicles[Players[L][1]].drawp("OnGround",NoTeamTag(Players[L][0])):Vehicles[Players[L][1]].draw("OnGround",NoTeamTag(Players[L][0]));for(let A=0;A<Players.length;A++)Players[A][0]==PlayerName?Vehicles[Players[A][1]].drawp("OnGround+1",NoTeamTag(Players[A][0])):Vehicles[Players[A][1]].draw("OnGround+1",NoTeamTag(Players[A][0]));for(let M=0;M<Players.length;M++)Players[M][0]==PlayerName?Vehicles[Players[M][1]].drawp("OnGround+2",NoTeamTag(Players[M][0])):Vehicles[Players[M][1]].draw("OnGround+2",NoTeamTag(Players[M][0]));for(let W of BulletsData.keys())0==BulletsData.get(W)[4]&&(1==BulletsData.get(W)[3]||3==BulletsData.get(W)[3]?(1>Math.random()&&PIXI.sound.play("dmg"+Math.floor(4*Math.random())),3==BulletsData.get(W)[3]&&(ShakeXbnds+=5,ShakeYbnds+=5),BulletsData.get(W)[3]=0):2==BulletsData.get(W)[3]&&(1>Math.random()&&PIXI.sound.play("Sdmg"+Math.floor(2*Math.random())),BulletsData.get(W)[3]=0),grad=ctx.createLinearGradient(GameW/2+OffsetX-(X-BulletsData.get(W)[0]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-BulletsData.get(W)[1]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom,GameW/2+OffsetX-(X-BulletsData.get(W)[0]+Math.cos(BulletsData.get(W)[2]/180*Math.PI)*BulletsData.get(W)[11]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-BulletsData.get(W)[1]+Math.sin(BulletsData.get(W)[2]/180*Math.PI)*BulletsData.get(W)[11]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom),Z<2?(grad.addColorStop(1,"#FFFF4400"),grad.addColorStop(0,"#FFFF4488")):(grad.addColorStop(1,"#ffff8800"),grad.addColorStop(0,"#ffff8877")),ctx.strokeStyle=grad,ctx.lineWidth=BulletsData.get(W)[6]/320*Zoom,ctx.beginPath(),ctx.lineCap="round",ctx.moveTo(GameW/2+OffsetX-(X-BulletsData.get(W)[0]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-BulletsData.get(W)[1]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom),ctx.lineTo(GameW/2+OffsetX-(X-BulletsData.get(W)[0]+Math.cos(BulletsData.get(W)[2]/180*Math.PI)*BulletsData.get(W)[11]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-BulletsData.get(W)[1]+Math.sin(BulletsData.get(W)[2]/180*Math.PI)*BulletsData.get(W)[11]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom),ctx.stroke(),ctx.closePath(),BulletsData.get(W)[0]=BulletsData.get(W)[8]+Math.cos(BulletsData.get(W)[2]/180*Math.PI)*BulletsData.get(W)[5]*((Date.now()-BulletsData.get(W)[10])/1e3),BulletsData.get(W)[1]=BulletsData.get(W)[9]+Math.sin(BulletsData.get(W)[2]/180*Math.PI)*BulletsData.get(W)[5]*((Date.now()-BulletsData.get(W)[10])/1e3),(Date.now()-BulletsData.get(W)[10])/1e3-1/15>0?(BulletsData.get(W)[11]=BulletsData.get(W)[5]*((Date.now()-BulletsData.get(W)[10])/1e3-2/15),BulletsData.get(W)[11]>.3&&(BulletsData.get(W)[11]=.3)):BulletsData.get(W)[11]=0,(BulletsData.get(W)[7]||BulletsData.get(W)[0]>20||BulletsData.get(W)[0]<-4||BulletsData.get(W)[1]>19||BulletsData.get(W)[1]<-4)&&BulletsData.delete(W));for(let E of SmokesData.keys())try{ctx.fillStyle="rgba(255,255,255,0.25)";let O=0;ctx.beginPath();let F=(Date.now()-SmokesData.get(E)[2])/100,C=(Math.sqrt(F)-(Math.sqrt(F)-17.3)*Math.sqrt(F)*.3)*.02;for(ctx.arc(OffsetX+(SmokesData.get(E)[0]-(X+(nX-X)*((Date.now()-LastPING)/PING)))*Zoom+GameW/2,OffsetY+GameH/2+(SmokesData.get(E)[1]-(Y+(nY-Y)*((Date.now()-LastPING)/PING)))*Zoom,C*Zoom,0,2*Math.PI),ctx.closePath(),ctx.fill(),t=0;t<SmokesData.get(E)[4].length;t++)SmokesData.get(E)[4][t].hp-=1,SmokesData.get(E)[4][t].dir+=.025*SmokesData.get(E)[4][t].spd,SmokesData.get(E)[4][t].hp<0&&(SmokesData.get(E)[4].splice(t,1),t--);for(t=0;t<SmokesData.get(E)[4].length;t++)ctx.fillStyle="rgba("+SmokesData.get(E)[4][t].cl+","+SmokesData.get(E)[4][t].cl+","+SmokesData.get(E)[4][t].cl+","+SmokesData.get(E)[4][t].hp/1500+")",ctx.beginPath(),O+=1,ctx.arc(Math.cos(SmokesData.get(E)[4][t].dir)*SmokesData.get(E)[4][t].h*C*.5*Zoom+(SmokesData.get(E)[0]-(X+(nX-X)*((Date.now()-LastPING)/PING)))*Zoom+GameW/2,Math.sin(SmokesData.get(E)[4][t].dir)*Zoom*SmokesData.get(E)[4][t].h*C*.5+OffsetY+OffsetY+GameH/2+(SmokesData.get(E)[1]-(Y+(nY-Y)*((Date.now()-LastPING)/PING)))*Zoom,C*Zoom,0,2*Math.PI),ctx.closePath(),ctx.fill();.1>Math.random()&&O<10&&SmokesData.get(E)[4].push(new Particle3(E)),SmokesData.get(E)[3]&&SmokesData.delete(E)}catch{SmokesData.delete(E)}for(let H of MAPstatic.S){ctx.fillStyle=MAPstatic.CT.sf,ctx.lineWidth=5/320*Zoom,ctx.lineJoin="round",ctx.strokeStyle=MAPstatic.CT.ss,ctx.beginPath();for(let V=0;V<H.length;V+=1)0==V?ctx.moveTo(GameW/2+OffsetX-(X-H[0][0]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-H[0][1]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom):ctx.lineTo(GameW/2+OffsetX-(X-H[V][0]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-H[V][1]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom);ctx.closePath(),ctx.fill(),ctx.stroke(),ctx.lineJoin="miter"}for(t=0;t<WtrBangParticles0.length;t++)ctx.fillStyle="rgba(255,255,255,"+WtrBangParticles0[t].life**.33*1+")",ctx.beginPath(),ctx.arc(OffsetX+(WtrBangParticles0[t].x-(X+(nX-X)*((Date.now()-LastPING)/PING)))*Zoom+GameW/2,OffsetY+GameH/2+(WtrBangParticles0[t].y-(Y+(nY-Y)*((Date.now()-LastPING)/PING)))*Zoom,WtrBangParticles0[t].rad/320*Zoom,0,2*Math.PI),ctx.closePath(),ctx.fill(),ctx.fillStyle="rgba(0,160,255,"+WtrBangParticles0[t].life**1*1+")",ctx.beginPath(),ctx.arc(OffsetX+(WtrBangParticles0[t].x-(X+(nX-X)*((Date.now()-LastPING)/PING)))*Zoom+GameW/2+Math.cos(WtrBangParticles0[t].dir+WtrBangParticles0[t].life*Math.PI*2)*WtrBangParticles0[t].rad*.2,OffsetY+GameH/2+(WtrBangParticles0[t].y-(Y+(nY-Y)*((Date.now()-LastPING)/PING)))*Zoom+Math.sin(WtrBangParticles0[t].dir+WtrBangParticles0[t].life*Math.PI*2)*WtrBangParticles0[t].rad*.2,.8*WtrBangParticles0[t].rad/320*Zoom,0,2*Math.PI),ctx.closePath(),ctx.fill(),WtrBangParticles0[t].dir+=.25*WtrBangParticles0[t].life,WtrBangParticles0[t].x+=WtrBangParticles0[t].xs/Zoom/4*WtrBangParticles0[t].life/320*Zoom,WtrBangParticles0[t].y+=WtrBangParticles0[t].ys/Zoom/4*WtrBangParticles0[t].life/320*Zoom,WtrBangParticles0[t].rad+=.75*WtrBangParticles0[t].life**1.25,WtrBangParticles0[t].life*=.98,WtrBangParticles0[t].life<1e-4&&(WtrBangParticles0.splice(t,1),t--);for(t=0;t<BangParticles0.length;t++)ctx.fillStyle="rgba(0,0,0,"+BangParticles0[t].life**.33*1+")",ctx.beginPath(),ctx.arc(OffsetX+(BangParticles0[t].x-(X+(nX-X)*((Date.now()-LastPING)/PING)))*Zoom+GameW/2,OffsetY+GameH/2+(BangParticles0[t].y-(Y+(nY-Y)*((Date.now()-LastPING)/PING)))*Zoom,BangParticles0[t].rad/320*Zoom,0,2*Math.PI),ctx.closePath(),ctx.fill(),ctx.fillStyle="rgba(255,160,0,"+BangParticles0[t].life**1*1+")",ctx.beginPath(),ctx.arc(OffsetX+(BangParticles0[t].x-(X+(nX-X)*((Date.now()-LastPING)/PING)))*Zoom+GameW/2+Math.cos(BangParticles0[t].dir+BangParticles0[t].life*Math.PI*2)*BangParticles0[t].rad*.2/320*Zoom,OffsetY+GameH/2+(BangParticles0[t].y-(Y+(nY-Y)*((Date.now()-LastPING)/PING)))*Zoom+Math.sin(BangParticles0[t].dir+BangParticles0[t].life*Math.PI*2)*BangParticles0[t].rad*.2/320*Zoom,BangParticles0[t].rad/320*Zoom*.8,0,2*Math.PI),ctx.closePath(),ctx.fill(),BangParticles0[t].dir+=.25*BangParticles0[t].life,BangParticles0[t].x+=BangParticles0[t].xs/4*BangParticles0[t].life/320,BangParticles0[t].y+=BangParticles0[t].ys/4*BangParticles0[t].life/320,BangParticles0[t].rad+=.75*BangParticles0[t].life**1.25,BangParticles0[t].life*=.98,BangParticles0[t].life<1e-4&&(BangParticles0.splice(t,1),t--);for(t=0;t<CanBangParticles1.length;t++)ctx.fillStyle="rgba(192,192,192,"+CanBangParticles1[t].life**1.5*1+")",ctx.beginPath(),ctx.arc(OffsetX+(CanBangParticles1[t].x-(X+(nX-X)*((Date.now()-LastPING)/PING)))*Zoom+GameW/2,OffsetY+GameH/2+(CanBangParticles1[t].y-(Y+(nY-Y)*((Date.now()-LastPING)/PING)))*Zoom,CanBangParticles1[t].rad/320*Zoom,0,2*Math.PI),ctx.closePath(),CanBangParticles1[t].x+=CanBangParticles1[t].xs/10*CanBangParticles1[t].life/320,CanBangParticles1[t].y+=CanBangParticles1[t].ys/10*CanBangParticles1[t].life/320,CanBangParticles1[t].rad+=.1*CanBangParticles1[t].life/320*Zoom,ctx.fill(),CanBangParticles1[t].life*=.99,CanBangParticles1[t].life<.001&&(CanBangParticles1.splice(t,1),t--);if(ParticlesProcessing)for(t=FireParticles1.length-1;t>=0;t--)ctx.fillStyle="rgba(255,"+255*FireParticles1[t].life/60+","+255*(FireParticles1[t].life/60)**3+","+.75*Math.sin(FireParticles1[t].life/60*Math.PI)+")",ctx.beginPath(),ctx.arc(OffsetX+(FireParticles1[t].x-(X+(nX-X)*((Date.now()-LastPING)/PING)))*Zoom+GameW/2-FireParticles1[t].cof*Math.cos(FireParticles1[t].dir)*FireParticles1[t].rad/320*Zoom,OffsetY+GameH/2+(FireParticles1[t].y-(Y+(nY-Y)*((Date.now()-LastPING)/PING)))*Zoom-FireParticles1[t].cof*Math.sin(FireParticles1[t].dir)*FireParticles1[t].rad/320*Zoom,FireParticles1[t].rad*Math.sin(FireParticles1[t].life/60*Math.PI)/320*Zoom,0,2*Math.PI),ctx.closePath(),ctx.fill(),FireParticles1[t].dirspd+=(2*Math.random()-1)*.03,FireParticles1[t].dir+=FireParticles1[t].dirspd,FireParticles1[t].x+=Math.cos(FireParticles1[t].deg)*FireParticles1[t].speed*Math.sin(FireParticles1[t].life/60*Math.PI)*(1-FireParticles1[t].life/60)/320,FireParticles1[t].y+=Math.sin(FireParticles1[t].deg)*FireParticles1[t].speed*Math.sin(FireParticles1[t].life/60*Math.PI)*(1-FireParticles1[t].life/60)/320,FireParticles1[t].life*=.95,FireParticles1[t].life<5&&(FireParticles1.splice(t,1),t--);else FireParticles1=[];for(t=0;t<BangParticles1.length;t++)ctx.fillStyle="rgba(0,0,0,"+BangParticles1[t].life**.33*1+")",ctx.beginPath(),ctx.arc(OffsetX+(BangParticles1[t].x-(X+(nX-X)*((Date.now()-LastPING)/PING)))*Zoom+GameW/2,OffsetY+GameH/2+(BangParticles1[t].y-(Y+(nY-Y)*((Date.now()-LastPING)/PING)))*Zoom,BangParticles1[t].rad/320*Zoom,0,2*Math.PI),ctx.closePath(),ctx.fill(),ctx.fillStyle="rgba(255,160,0,"+BangParticles1[t].life**1*1+")",ctx.beginPath(),ctx.arc(OffsetX+(BangParticles1[t].x-(X+(nX-X)*((Date.now()-LastPING)/PING)))*Zoom+GameW/2+Math.cos(BangParticles1[t].dir+BangParticles1[t].life*Math.PI*2)*BangParticles1[t].rad*.2/320*Zoom,OffsetY+GameH/2+(BangParticles1[t].y-(Y+(nY-Y)*((Date.now()-LastPING)/PING)))*Zoom+Math.sin(BangParticles1[t].dir+BangParticles1[t].life*Math.PI*2)*BangParticles1[t].rad*.2/320*Zoom,.8*BangParticles1[t].rad/320*Zoom,0,2*Math.PI),ctx.closePath(),ctx.fill(),BangParticles1[t].dir+=.25*BangParticles1[t].life,BangParticles1[t].x+=BangParticles1[t].xs/4*BangParticles1[t].life/320,BangParticles1[t].y+=BangParticles1[t].ys/4*BangParticles1[t].life/320,BangParticles1[t].rad+=.75*BangParticles1[t].life**1.25,BangParticles1[t].life*=.98,BangParticles1[t].life<1e-4&&(BangParticles1.splice(t,1),t--);for(let R of BombsData.keys()){let U=(Date.now()-BombsData.get(R)[6])/1e3/BombsData.get(R)[5],q=BombsData.get(R)[0]+(BombsData.get(R)[2]-BombsData.get(R)[0])*U,z=BombsData.get(R)[1]+(BombsData.get(R)[3]-BombsData.get(R)[1])*U;if(1==BombsData.get(R)[4]){BombsData.get(R)[4]=0,PIXI.sound.play("bang");for(let j=0;j<5;j++)BangParticles1.push(new bangPrt(BombsData.get(R)[2],BombsData.get(R)[3]));ShakeXbnds+=10,ShakeYbnds+=10}else if(2==BombsData.get(R)[4])PIXI.sound.play("bombFall"),BombsData.get(R)[4]=0;else if(4==BombsData.get(R)[4]){PIXI.sound.play("wtrBang");for(let J=0;J<5;J++)WtrBangParticles0.push(new BangPrt0(BombsData.get(R)[2],BombsData.get(R)[3]));ShakeXbnds+=5,ShakeYbnds+=5}ctx.strokeStyle="#111",ctx.lineWidth=3/320*Zoom,ctx.beginPath(),ctx.lineCap="round",bmbLen=.015,ctx.moveTo(GameW/2+OffsetX-(X-q+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-z+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom),ctx.lineTo(GameW/2+OffsetX-(X-q+Math.cos(BombsData.get(R)[8]/180*Math.PI)*bmbLen+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-z+Math.sin(BombsData.get(R)[8]/180*Math.PI)*bmbLen+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom),ctx.stroke(),ctx.closePath(),(BombsData.get(R)[7]||q>16||q<0||z>16||z<0)&&(console.log(q,z),BombsData.delete(R))}for(let K of AARocketsData.keys()){if(1==AARocketsData.get(K)[3]){AARocketsData.get(K)[3]=0,PIXI.sound.play("rocketHit");for(let Q=0;Q<15;Q++)FireParticles1.push(new FirePrt0(AARocketsData.get(K)[0],AARocketsData.get(K)[1],.75));ShakeXbnds+=10,ShakeYbnds+=10}else if(2==AARocketsData.get(K)[3])PIXI.sound.play("lnchRckt"),AARocketsData.get(K)[3]=0;else if(4==AARocketsData.get(K)[3])for(let ee=0;ee<3;ee++)FireParticles1.push(new FirePrt0(AARocketsData.get(K)[0],AARocketsData.get(K)[1],.5));grad=ctx.createLinearGradient(GameW/2+OffsetX-(X-AARocketsData.get(K)[0]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-AARocketsData.get(K)[1]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom,GameW/2+OffsetX-(X-AARocketsData.get(K)[0]+Math.cos(AARocketsData.get(K)[2]/180*Math.PI)*AARocketsData.get(K)[4]/10+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-AARocketsData.get(K)[1]+Math.sin(AARocketsData.get(K)[2]/180*Math.PI)*AARocketsData.get(K)[4]/10+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom),1>Math.random()&&RocketTraceParticles.push(new RcktTPrt0(AARocketsData.get(K)[0]-Math.cos(AARocketsData.get(K)[2]/180*Math.PI)*AARocketsData.get(K)[4]/20,AARocketsData.get(K)[1]-Math.sin(AARocketsData.get(K)[2]/180*Math.PI)*AARocketsData.get(K)[4]/20)),grad.addColorStop(1,"#FF880088"),grad.addColorStop(0,"#cc0000ff"),ctx.strokeStyle=grad,ctx.lineWidth=2/320*Zoom,ctx.beginPath(),ctx.lineCap="round",ctx.moveTo(GameW/2+OffsetX-(X-AARocketsData.get(K)[0]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-AARocketsData.get(K)[1]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom),ctx.lineTo(GameW/2+OffsetX-(X-AARocketsData.get(K)[0]+Math.cos(AARocketsData.get(K)[2]/180*Math.PI)*AARocketsData.get(K)[4]/10+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-AARocketsData.get(K)[1]+Math.sin(AARocketsData.get(K)[2]/180*Math.PI)*AARocketsData.get(K)[4]/10+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom),ctx.stroke(),ctx.closePath();let et=(Date.now()-AARocketsData.get(K)[8])/1e3;distanceFromStart=AARocketsData.get(K)[4]*et+AARocketsData.get(K)[9]*et*et/2,AARocketsData.get(K)[0]=AARocketsData.get(K)[6]+Math.cos(AARocketsData.get(K)[2]/180*Math.PI)*distanceFromStart,AARocketsData.get(K)[1]=AARocketsData.get(K)[7]+Math.sin(AARocketsData.get(K)[2]/180*Math.PI)*distanceFromStart,(AARocketsData.get(K)[5]||AARocketsData.get(K)[0]>20||AARocketsData.get(K)[0]<-4||AARocketsData.get(K)[1]>19||AARocketsData.get(K)[1]<-4)&&AARocketsData.delete(K)}if(ParticlesProcessing)for(t=RocketTraceParticles.length-1;t>=0;t--)ctx.fillStyle="rgba("+(150+105*RocketTraceParticles[t].life).toString()+","+(150+105*RocketTraceParticles[t].life).toString()+","+(150-150*RocketTraceParticles[t].life)+","+255*RocketTraceParticles[t].life+")",ctx.beginPath(),ctx.arc(OffsetX+(RocketTraceParticles[t].x-(X+(nX-X)*((Date.now()-LastPING)/PING)))*Zoom+GameW/2,OffsetY+GameH/2+(RocketTraceParticles[t].y-(Y+(nY-Y)*((Date.now()-LastPING)/PING)))*Zoom,RocketTraceParticles[t].rad*RocketTraceParticles[t].life**.3*2/320*Zoom,0,2*Math.PI),ctx.closePath(),ctx.fill(),RocketTraceParticles[t].life*=.7,RocketTraceParticles[t].life<.05&&(RocketTraceParticles.splice(t,1),t--);else RocketTraceParticles=[];for(t=0,ctx.globalCompositeOperation="color";t<TracerParticles1.length;t++)ctx.strokeStyle="rgba(200,0,0,"+TracerParticles1[t].life**.2*4+")",ctx.lineWidth=3/320*Zoom,ctx.lineJoin="round",ctx.beginPath(),ctx.moveTo(OffsetX+(TracerParticles1[t].x-(X+(nX-X)*((Date.now()-LastPING)/PING)))*Zoom+GameW/2,OffsetY+GameH/2+(TracerParticles1[t].y-(Y+(nY-Y)*((Date.now()-LastPING)/PING)))*Zoom),ctx.lineTo(OffsetX+(TracerParticles1[t].x1-(X+(nX-X)*((Date.now()-LastPING)/PING)))*Zoom+GameW/2,OffsetY+GameH/2+(TracerParticles1[t].y1-(Y+(nY-Y)*((Date.now()-LastPING)/PING)))*Zoom),ctx.closePath(),ctx.stroke(),TracerParticles1[t].life*=.93,TracerParticles1[t].life<1e-8&&(TracerParticles1.splice(t,1),t--);for(let ea of(ctx.globalCompositeOperation="source-over",BulletsData.keys()))1==BulletsData.get(ea)[4]&&(1==BulletsData.get(ea)[3]||3==BulletsData.get(ea)[3]?(1>Math.random()&&PIXI.sound.play("dmg"+Math.floor(4*Math.random())),3==BulletsData.get(ea)[3]&&(ShakeXbnds+=5,ShakeYbnds+=5),BulletsData.get(ea)[3]=0):2==BulletsData.get(ea)[3]&&(1>Math.random()&&PIXI.sound.play("Sdmg"+Math.floor(2*Math.random())),BulletsData.get(ea)[3]=0),grad=ctx.createLinearGradient(GameW/2+OffsetX-(X-BulletsData.get(ea)[0]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-BulletsData.get(ea)[1]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom,GameW/2+OffsetX-(X-BulletsData.get(ea)[0]+Math.cos(BulletsData.get(ea)[2]/180*Math.PI)*BulletsData.get(ea)[11]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-BulletsData.get(ea)[1]+Math.sin(BulletsData.get(ea)[2]/180*Math.PI)*BulletsData.get(ea)[11]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom),2==Z?(grad.addColorStop(1,"#FFFF4400"),grad.addColorStop(0,"#FFFF4488")):(grad.addColorStop(1,"#ffffaa00"),grad.addColorStop(0,"#ffffaa88")),ctx.strokeStyle=grad,ctx.lineWidth=BulletsData.get(ea)[6]/320*Zoom,ctx.beginPath(),ctx.lineCap="round",ctx.moveTo(GameW/2+OffsetX-(X-BulletsData.get(ea)[0]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-BulletsData.get(ea)[1]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom),ctx.lineTo(GameW/2+OffsetX-(X-BulletsData.get(ea)[0]+Math.cos(BulletsData.get(ea)[2]/180*Math.PI)*BulletsData.get(ea)[11]+(nX-X)*(Date.now()-LastPING)/PING)*Zoom,GameH/2+OffsetY-(Y-BulletsData.get(ea)[1]+Math.sin(BulletsData.get(ea)[2]/180*Math.PI)*BulletsData.get(ea)[11]+(nY-Y)*(Date.now()-LastPING)/PING)*Zoom),ctx.stroke(),ctx.closePath(),BulletsData.get(ea)[0]=BulletsData.get(ea)[8]+Math.cos(BulletsData.get(ea)[2]/180*Math.PI)*BulletsData.get(ea)[5]*((Date.now()-BulletsData.get(ea)[10])/1e3),BulletsData.get(ea)[1]=BulletsData.get(ea)[9]+Math.sin(BulletsData.get(ea)[2]/180*Math.PI)*BulletsData.get(ea)[5]*((Date.now()-BulletsData.get(ea)[10])/1e3),(Date.now()-BulletsData.get(ea)[10])/1e3-1/15>0?(BulletsData.get(ea)[11]=BulletsData.get(ea)[5]*((Date.now()-BulletsData.get(ea)[10])/1e3-2/15),BulletsData.get(ea)[11]>.3&&(BulletsData.get(ea)[11]=.3)):BulletsData.get(ea)[11]=0,(BulletsData.get(ea)[7]||BulletsData.get(ea)[0]>20||BulletsData.get(ea)[0]<-4||BulletsData.get(ea)[1]>19||BulletsData.get(ea)[1]<-4)&&BulletsData.delete(ea));for(let es=0;es<Players.length;es++)Players[es][0]==PlayerName?Vehicles[Players[es][1]].drawp("Air-2",NoTeamTag(Players[es][0])):Vehicles[Players[es][1]].draw("Air-2",NoTeamTag(Players[es][0]));for(let el=0;el<Players.length;el++)Players[el][0]==PlayerName?Vehicles[Players[el][1]].drawp("Air-1",NoTeamTag(Players[el][0])):Vehicles[Players[el][1]].draw("Air-1",NoTeamTag(Players[el][0]));for(let en=0;en<Players.length;en++)Players[en][0]==PlayerName?Vehicles[Players[en][1]].drawp("Air",NoTeamTag(Players[en][0])):Vehicles[Players[en][1]].draw("Air",NoTeamTag(Players[en][0]));for(let eo=0;eo<Players.length;eo++)Players[eo][0]==PlayerName?Vehicles[Players[eo][1]].drawp("Air+1",NoTeamTag(Players[eo][0])):Vehicles[Players[eo][1]].draw("Air+1",NoTeamTag(Players[eo][0]));for(let ei=0;ei<Players.length;ei++)Players[ei][0]==PlayerName?Vehicles[Players[ei][1]].drawp("Air+2",NoTeamTag(Players[ei][0])):Vehicles[Players[ei][1]].draw("Air+2",NoTeamTag(Players[ei][0]));if(ParticlesProcessing)for(t=FireParticles2.length-1;t>=0;t--)ctx.fillStyle="rgba(255,"+255*FireParticles2[t].life/60+","+255*(FireParticles2[t].life/60)**3+","+.75*Math.sin(FireParticles2[t].life/60*Math.PI)+")",ctx.beginPath(),ctx.arc(OffsetX+(FireParticles2[t].x-(X+(nX-X)*((Date.now()-LastPING)/PING)))*Zoom+GameW/2-FireParticles2[t].cof*Math.cos(FireParticles2[t].dir)*FireParticles2[t].rad/320*Zoom,OffsetY+GameH/2+(FireParticles2[t].y-(Y+(nY-Y)*((Date.now()-LastPING)/PING)))*Zoom-FireParticles2[t].cof*Math.sin(FireParticles2[t].dir)*FireParticles2[t].rad/320*Zoom,FireParticles2[t].rad*Math.sin(FireParticles2[t].life/60*Math.PI)/320*Zoom,0,2*Math.PI),ctx.closePath(),ctx.fill(),FireParticles2[t].dirspd+=(2*Math.random()-1)*.03,FireParticles2[t].dir+=FireParticles2[t].dirspd,FireParticles2[t].x+=Math.cos(FireParticles2[t].deg)*FireParticles2[t].speed*Math.sin(FireParticles2[t].life/60*Math.PI)*(1-FireParticles2[t].life/60)/320,FireParticles2[t].y+=Math.sin(FireParticles2[t].deg)*FireParticles2[t].speed*Math.sin(FireParticles2[t].life/60*Math.PI)*(1-FireParticles2[t].life/60)/320,FireParticles2[t].life*=.95,FireParticles2[t].life<5&&(FireParticles2.splice(t,1),t--);else FireParticles1=[];for(t=0;t<BangParticles2.length;t++)ctx.fillStyle="rgba(0,0,0,"+BangParticles2[t].life**.33*1+")",ctx.beginPath(),ctx.arc(OffsetX+(BangParticles2[t].x-(X+(nX-X)*((Date.now()-LastPING)/PING)))*Zoom+GameW/2,OffsetY+GameH/2+(BangParticles2[t].y-(Y+(nY-Y)*((Date.now()-LastPING)/PING)))*Zoom,BangParticles2[t].rad/320*Zoom,0,2*Math.PI),ctx.closePath(),ctx.fill(),ctx.fillStyle="rgba(255,160,0,"+BangParticles2[t].life**1*1+")",ctx.beginPath(),ctx.arc(OffsetX+(BangParticles2[t].x-(X+(nX-X)*((Date.now()-LastPING)/PING)))*Zoom+GameW/2+Math.cos(BangParticles2[t].dir+BangParticles2[t].life*Math.PI*2)*BangParticles2[t].rad*.2/320*Zoom,OffsetY+GameH/2+(BangParticles2[t].y-(Y+(nY-Y)*((Date.now()-LastPING)/PING)))*Zoom+Math.sin(BangParticles2[t].dir+BangParticles2[t].life*Math.PI*2)*BangParticles2[t].rad*.2/320*Zoom,.8*BangParticles2[t].rad/320*Zoom,0,2*Math.PI),ctx.closePath(),ctx.fill(),BangParticles2[t].dir+=.25*BangParticles2[t].life,BangParticles2[t].x+=BangParticles2[t].xs/Zoom/4*BangParticles2[t].life,BangParticles2[t].y+=BangParticles2[t].ys/Zoom/4*BangParticles2[t].life,BangParticles2[t].rad+=.75*BangParticles2[t].life**1.25,BangParticles2[t].life*=.98,BangParticles2[t].life<1e-4&&(BangParticles2.splice(t,1),t--);for(t=0;t<SnowParticles0.length;t++)Math.abs(nX-X)>1||Math.abs(nY-Y)>1||(SnowParticles0[t].ra+=SnowParticles0[t].as,SnowParticles0[t].x-=SnowParticles0[t].d*Math.sqrt(SnowParticles0[t].r/2)*Math.cos(SnowParticles0[t].ra),SnowParticles0[t].y-=SnowParticles0[t].d*Math.sqrt(SnowParticles0[t].r/2)*Math.sin(SnowParticles0[t].ra),SnowParticles0[t].x-=SnowParticles0[t].d*Math.sqrt(SnowParticles0[t].r/2)*(nX-X)*Zoom,SnowParticles0[t].y-=SnowParticles0[t].d*Math.sqrt(SnowParticles0[t].r/2)*(nY-Y)*Zoom),SnowParticles0[t].x>canvas.width+5?SnowParticles0[t].x=-5:SnowParticles0[t].x<-5&&(SnowParticles0[t].x=canvas.width+5),SnowParticles0[t].y>canvas.height+5?SnowParticles0[t].y=-5:SnowParticles0[t].y<-5&&(SnowParticles0[t].y=canvas.height+5),ctx.fillStyle="rgba(255, 255, 255, 0.75)",ctx.beginPath(),ctx.arc(SnowParticles0[t].x,SnowParticles0[t].y,SnowParticles0[t].r,0,2*Math.PI,!0),ctx.closePath(),ctx.fill();for(let er=0;er<Players.length;er++)Players[er][0]==PlayerName?Vehicles[Players[er][1]].drawp("Info-2",NoTeamTag(Players[er][0])):Vehicles[Players[er][1]].draw("Info-2",NoTeamTag(Players[er][0]));for(let ec=0;ec<Players.length;ec++)Players[ec][0]==PlayerName?Vehicles[Players[ec][1]].drawp("Info-1",NoTeamTag(Players[ec][0])):Vehicles[Players[ec][1]].draw("Info-1",NoTeamTag(Players[ec][0]));for(let e$=0;e$<Players.length;e$++)Players[e$][0]==PlayerName?Vehicles[Players[e$][1]].drawp("Info",NoTeamTag(Players[e$][0])):Vehicles[Players[e$][1]].draw("Info",NoTeamTag(Players[e$][0]));for(let em=0;em<Players.length;em++)Players[em][0]==PlayerName?Vehicles[Players[em][1]].drawp("Info+1",NoTeamTag(Players[em][0])):Vehicles[Players[em][1]].draw("Info+1",NoTeamTag(Players[em][0]));for(let eP=0;eP<Players.length;eP++)Players[eP][0]==PlayerName?Vehicles[Players[eP][1]].drawp("Info+2",NoTeamTag(Players[eP][0])):Vehicles[Players[eP][1]].draw("Info+2",NoTeamTag(Players[eP][0]));window.requestAnimationFrame(DRAW)}catch(eg){console.log(eg,eg.stack),window.requestAnimationFrame(DRAW)}}function mousepos(e){mouseX=e.pageX,mouseY=e.pageY}function startgamebtn(){PIXI.sound.stop("MainMenuMusic"),document.getElementById("TitleScreen").classList=["titlescrs"],setTimeout(startgame,1500)}LastAnime=Date.now(),window.requestAnimationFrame(DRAW),window.onload=function(){document.getElementById("TitleScreen").classList=["titlescrh"],GetServerInfo(),navigator.userAgent.match(/iPhone/i)&&document.documentElement.requestFullscreen()};